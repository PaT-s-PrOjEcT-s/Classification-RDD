                `${searchTerm} chemical safety MSDS`,
                `${searchTerm} hazardous waste classification`,
                `${searchTerm} ingredients composition`
            ];
            
            for (const query of searchQueries) {
                const duckUrl = `https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_redirect=1&no_html=1`;
                
                for (const proxy of corsProxies) {
                    try {
                        const proxyUrl = proxy + encodeURIComponent(duckUrl);
                        const response = await fetch(proxyUrl, { 
                            timeout: 5000,
                            headers: { 'Accept': 'application/json' }
                        });
                        
                        if (response.ok) {
                            let data = await response.text();
                            
                            // Traiter selon le proxy
                            if (proxy.includes('allorigins')) {
                                const parsed = JSON.parse(data);
                                data = parsed.contents;
                            }
                            
                            const jsonData = JSON.parse(data);
                            
                            if (jsonData.Abstract && jsonData.Abstract.length > 30) {
                                searchResults.push({
                                    source: 'DuckDuckGo',
                                    title: jsonData.Heading || searchTerm,
                                    content: jsonData.Abstract,
                                    url: jsonData.AbstractURL || '',
                                    confidence: 'moyenne'
                                });
                                console.log('‚úÖ DuckDuckGo trouv√© via', proxy);
                                break; // Sortir de la boucle des proxies
                            }
                        }
                    } catch (proxyError) {
                        console.log(`‚ùå Proxy ${proxy} √©chou√©:`, proxyError.message);
                    }
                }
                
                if (searchResults.length >= 3) break; // Limiter √† 3 sources max
            }
            
            // 3. Base de donn√©es de s√©curit√© chimique int√©gr√©e
            const safetyPatterns = [
                {
                    pattern: /hydrogen\s*peroxide|peroxyde.*hydrog√®ne|welloxon|developer|d√©veloppeur/i,
                    category: 'Oxydant',
                    description: 'Agent oxydant contenant du peroxyde d\'hydrog√®ne',
                    confidence: '√©lev√©e',
                    source: 'Base s√©curit√©'
                },
                {
                    pattern: /pesticide|herbicide|insecticide|roundup|glyphosate/i,
                    category: 'Toxique',
                    description: 'Pesticide ou substance toxique',
                    confidence: '√©lev√©e',
                    source: 'EPA Pattern'
                },
                {
                    pattern: /chlorine|chlore|pool.*shock|calcium.*hypochlorite|hth/i,
                    category: 'Comburants',
                    description: 'Agent comburant chlor√© pour piscine',
                    confidence: '√©lev√©e',
                    source: 'NIOSH Pattern'
                },
                {
                    pattern: /acid|acide|hydrochloric|sulfuric|muriatic/i,
                    category: 'Acide',
                    description: 'Substance corrosive acide',
                    confidence: 'moyenne',
                    source: 'Pattern Chimique'
                },
                {
                    pattern: /bleach|javellisant|ammonia|caustic|sodium.*hydroxide/i,
                    category: 'Base',
                    description: 'Substance corrosive basique',
                    confidence: 'moyenne',
                    source: 'Pattern Chimique'
                }
            ];
            
            const searchLower = searchTerm.toLowerCase();
            for (const pattern of safetyPatterns) {
                if (pattern.pattern.test(searchLower)) {
                    searchResults.push({
                        source: pattern.source,
                        title: `${searchTerm} Safety Classification`,
                        content: `Product matches safety database patterns indicating classification as ${pattern.category}: ${pattern.description}`,
                        category: pattern.category,
                        confidence: pattern.confidence,
                        safety: true
                    });
                    console.log(`‚úÖ ${pattern.source} pattern match: ${pattern.category}`);
                }
            }
            
            console.log(`üìä Total r√©sultats web: ${searchResults.length}`);
            return searchResults;
        }

        async function analyzeOpenSourceResults(searchTerm, searchResults) {
            console.log(`üî¨ Analyse avanc√©e des r√©sultats pour: ${searchTerm}`);
            
            if (searchResults.length === 0) {
                console.log('‚ùå Aucun r√©sultat √† analyser');
                return { isRDD: false, category: null, confidence: 'faible' };
            }
            
            // Combiner tout le contenu textuel
            const combinedText = searchResults.map(result => 
                `${result.title} ${result.content}`.toLowerCase()
            ).join(' ');
            
            console.log(`üìù Analyse de ${combinedText.length} caract√®res`);
            
            // R√®gles de classification avec scoring sophistiqu√©
            const classificationRules = [
                // OXYDANTS - Priorit√© maximale
                {
                    category: 'Oxydant',
                    patterns: [
                        { regex: /hydrogen\s*peroxide|peroxyde.*hydrog√®ne/gi, score: 20, desc: 'Peroxyde hydrog√®ne' },
                        { regex: /welloxon|developer.*hair|hair.*developer|d√©veloppeur.*capillaire/gi, score: 18, desc: 'D√©veloppeur capillaire' },
                        { regex: /\b\d+\s*volume.*developer|developer.*\d+\s*volume/gi, score: 15, desc: 'D√©veloppeur volume' },
                        { regex: /cream.*developer|developer.*cream/gi, score: 12, desc: 'D√©veloppeur cr√®me' },
                        { regex: /oxidizing.*agent|agent.*oxydant|bleaching.*agent/gi, score: 10, desc: 'Agent oxydant' },
                        { regex: /activator.*color|color.*activator/gi, score: 8, desc: 'Activateur couleur' }
                    ],
                    confidence: '√©lev√©e',
                    priority: 10
                },
                
                // COMBURANTS - Produits chlor√©s
                {
                    category: 'Comburants',
                    patterns: [
                        { regex: /calcium.*hypochlorite|hypochlorite.*calcium/gi, score: 18, desc: 'Hypochlorite calcium' },
                        { regex: /pool.*shock|shock.*pool/gi, score: 15, desc: 'Choc piscine' },
                        { regex: /\bhth\b|bleaching.*powder/gi, score: 12, desc: 'HTH/Poudre blanchissante' },
                        { regex: /chlorine.*pool|pool.*chlorine/gi, score: 10, desc: 'Chlore piscine' },
                        { regex: /swimming.*pool.*chemical/gi, score: 8, desc: 'Produit chimique piscine' }
                    ],
                    confidence: '√©lev√©e',
                    priority: 9
                },
                
                // TOXIQUES - Pesticides et poisons
                {
                    category: 'Toxique',
                    patterns: [
                        { regex: /glyphosate|roundup/gi, score: 20, desc: 'Glyphosate/Roundup' },
                        { regex: /pesticide|herbicide|insecticide|rodenticide/gi, score: 18, desc: 'Pesticide' },
                        { regex: /\btoxic\b|poison|venom|deadly/gi, score: 15, desc: 'Substance toxique' },
                        { regex: /kill.*pest|pest.*control|bug.*spray/gi, score: 12, desc: 'Contr√¥le parasites' },
                        { regex: /weed.*killer|killer.*weed/gi, score: 10, desc: 'Tue-mauvaises herbes' },
                        { regex: /rat.*poison|mouse.*poison/gi, score: 15, desc: 'Poison rongeurs' }
                    ],
                    confidence: '√©lev√©e',
                    priority: 8
                },
                
                // ACIDES
                {
                    category: 'Acide',
                    patterns: [
                        { regex: /hydrochloric.*acid|muriatic.*acid/gi, score: 18, desc: 'Acide chlorhydrique' },
                        { regex: /sulfuric.*acid|battery.*acid/gi, score: 18, desc: 'Acide sulfurique' },
                        { regex: /phosphoric.*acid/gi, score: 15, desc: 'Acide phosphorique' },
                        { regex: /\bacid\b.*cleaner|cleaner.*acid/gi, score: 12, desc: 'Nettoyant acide' },
                        { regex: /rust.*remover|lime.*remover/gi, score: 10, desc: 'Enl√®ve-rouille/tartre' },
                        { regex: /low.*ph|ph.*\d+.*acid/gi, score: 8, desc: 'pH acide' }
                    ],
                    confidence: '√©lev√©e',
                    priority: 7
                },
                
                // BASES
                {
                    category: 'Base',
                    patterns: [
                        { regex: /sodium.*hydroxide|potassium.*hydroxide/gi, score: 18, desc: 'Hydroxyde sodium/potassium' },
                        { regex: /\bcaustic\b|lye/gi, score: 15, desc: 'Substance caustique' },
                        { regex: /drain.*cleaner|oven.*cleaner/gi, score: 12, desc: 'Nettoyant d√©bouchoir/four' },
                        { regex: /\bbleach\b|javellisant/gi, score: 10, desc: 'Eau de javel' },
                        { regex: /ammonia|ammoniac/gi, score: 12, desc: 'Ammoniaque' },
                        { regex: /high.*ph|alkaline|basic.*solution/gi, score: 8, desc: 'Solution basique' }
                    ],
                    confidence: '√©lev√©e',
                    priority: 6
                },
                
                // COMBUSTIBLES
                {
                    category: 'Combustible',
                    patterns: [
                        { regex: /gasoline|petrol|essence/gi, score: 18, desc: 'Essence' },
                        { regex: /diesel|gazole/gi, score: 18, desc: 'Diesel' },
                        { regex: /propane|butane/gi, score: 15, desc: 'Gaz GPL' },
                        { regex: /kerosene|fuel.*oil/gi, score: 12, desc: 'K√©ros√®ne/Mazout' },
                        { regex: /flammable|combustible|ignitable/gi, score: 10, desc: 'Substance inflammable' },
                        { regex: /lighter.*fluid|charcoal.*lighter/gi, score: 8, desc: 'Liquide allume-feu' }
                    ],
                    confidence: '√©lev√©e',
                    priority: 5
                },
                
                // HUILES
                {
                    category: 'Huiles',
                    patterns: [
                        { regex: /motor.*oil|engine.*oil/gi, score: 18, desc: 'Huile moteur' },
                        { regex: /hydraulic.*oil|hydraulic.*fluid/gi, score: 15, desc: 'Huile hydraulique' },
                        { regex: /transmission.*fluid|brake.*fluid/gi, score: 15, desc: 'Liquide transmission/frein' },
                        { regex: /used.*oil|waste.*oil/gi, score: 12, desc: 'Huile usag√©e' },
                        { regex: /lubricant|lubrifying/gi, score: 10, desc: 'Lubrifiant' },
                        { regex: /wd-40|penetrating.*oil/gi, score: 8, desc: 'Huile p√©n√©trante' }
                    ],
                    confidence: '√©lev√©e',
                    priority: 4
                },
                
                // PEINTURES
                {
                    category: 'Peinture',
                    patterns: [
                        { regex: /\bpaint\b(?!.*remover)|peinture/gi, score: 15, desc: 'Peinture' },
                        { regex: /latex.*paint|acrylic.*paint/gi, score: 12, desc: 'Peinture latex/acrylique' },
                        { regex: /oil.*based.*paint|alkyd.*paint/gi, score: 12, desc: 'Peinture √† l\'huile' },
                        { regex: /primer|undercoat|appr√™t/gi, score: 10, desc: 'Appr√™t/Sous-couche' },
                        { regex: /stain.*wood|wood.*stain|teinture/gi, score: 10, desc: 'Teinture bois' },
                        { regex: /varnish|lacquer|vernis/gi, score: 8, desc: 'Vernis/Laque' }
                    ],
                    confidence: 'moyenne',
                    priority: 3
                },
                
                // ORGANIQUES
                {
                    category: 'Organique',
                    patterns: [
                        { regex: /acetone|ac√©tone/gi, score: 15, desc: 'Ac√©tone' },
                        { regex: /toluene|tolu√®ne|xylene|xyl√®ne/gi, score: 15, desc: 'Tolu√®ne/Xyl√®ne' },
                        { regex: /mineral.*spirits|white.*spirit/gi, score: 12, desc: 'Essence min√©rale' },
                        { regex: /turpentine|t√©r√©benthine/gi, score: 12, desc: 'T√©r√©benthine' },
                        { regex: /\bsolvent\b|solvant|thinner/gi, score: 10, desc: 'Solvant' },
                        { regex: /degreaser|d√©graissant/gi, score: 8, desc: 'D√©graissant' },
                        { regex: /nail.*polish.*remover/gi, score: 6, desc: 'Dissolvant vernis' }
                    ],
                    confidence: 'moyenne',
                    priority: 2
                }
            ];
            
            // Calculer les scores avec pond√©ration avanc√©e
            let bestMatch = null;
            let bestScore = 0;
            let bestPriority = 0;
            let analysisDetails = [];
            
            for (const rule of classificationRules) {
                let totalScore = 0;
                let matchedPatterns = [];
                
                for (const pattern of rule.patterns) {
                    const matches = combinedText.match(pattern.regex) || [];
                    if (matches.length > 0) {
                        const patternScore = pattern.score * Math.min(matches.length, 3); // Max 3x bonus
                        totalScore += patternScore;
                        matchedPatterns.push({
                            description: pattern.desc,
                            matches: matches.length,
                            score: patternScore,
                            examples: matches.slice(0, 2) // Garder 2 exemples
                        });
                    }
                }
                
                // Bonus pour correspondance dans le terme de recherche
                const searchTermLower = searchTerm.toLowerCase();
                for (const pattern of rule.patterns) {
                    if (pattern.regex.test(searchTermLower)) {
                        const bonus = pattern.score * 3; // Triple bonus
                        totalScore += bonus;
                        console.log(`üéØ Bonus terme recherche: +${bonus} pour ${rule.category}`);
                    }
                }
                
                // Bonus pour r√©sultats de s√©curit√©
                const safetyResults = searchResults.filter(r => r.safety && r.category === rule.category);
                if (safetyResults.length > 0) {
                    totalScore += 25; // Gros bonus s√©curit√©
                    console.log(`üõ°Ô∏è Bonus s√©curit√©: +25 pour ${rule.category}`);
                }
                
                // Bonus pour sources fiables (Wikipedia)
                const wikiResults = searchResults.filter(r => r.source === 'Wikipedia');
                if (wikiResults.length > 0 && totalScore > 0) {
                    totalScore += 10; // Bonus source fiable
                    console.log(`üìñ Bonus Wikipedia: +10 pour ${rule.category}`);
                }
                
                if (totalScore > 0) {
                    analysisDetails.push({
                        category: rule.category,
                        score: totalScore,
                        priority: rule.priority,
                        matchedPatterns: matchedPatterns,
                        confidence: rule.confidence
                    });
                    
                    console.log(`üìä ${rule.category}: score=${totalScore}, priorit√©=${rule.priority}`);
                    
                    // S√©lection bas√©e sur priorit√© puis score
                    if (rule.priority > bestPriority || 
                        (rule.priority === bestPriority && totalScore > bestScore)) {
                        bestMatch = {
                            ...rule,
                            score: totalScore,
                            matchedPatterns: matchedPatterns
                        };
                        bestScore = totalScore;
                        bestPriority = rule.priority;
                    }
                }
            }
            
            // Seuil adaptatif selon la priorit√©
            const minScore = bestPriority >= 8 ? 8 : 12; // Seuil plus bas pour toxiques/oxydants
            
            if (bestMatch && bestScore >= minScore) {
                console.log(`‚úÖ Classification r√©ussie: ${bestMatch.category} (score: ${bestScore}, priorit√©: ${bestPriority})`);
                
                // Description contextuelle intelligente
                let description = `Produit ${bestMatch.category.toLowerCase()}`;
                
                if (bestMatch.category === 'Oxydant') {
                    if (combinedText.includes('hair') || combinedText.includes('developer') || combinedText.includes('welloxon')) {
                        description += ' capillaire (peroxyde d\'hydrog√®ne)';
                    } else {
                        description += ' (agent oxydant)';
                    }
                } else if (bestMatch.category === 'Toxique') {
                    if (combinedText.includes('pest') || combinedText.includes('weed')) {
                        description += ' (pesticide/herbicide)';
                    } else if (combinedText.includes('rat') || combinedText.includes('mouse')) {
                        description += ' (rodenticide)';
                    } else {
                        description += ' (substance dangereuse)';
                    }
                } else if (bestMatch.category === 'Comburants') {
                    description += ' (produit chlor√© piscine)';
                } else if (bestMatch.category === 'Huiles') {
                    if (combinedText.includes('motor') || combinedText.includes('engine')) {
                        description += ' (huile moteur)';
                    } else {
                        description += ' (lubrifiant)';
                    }
                }
                
                description += ' - Classification par recherche web intelligente';
                
                return {
                    isRDD: true,
                    category: bestMatch.category,
                    confidence: bestMatch.confidence,
                    description: description,
                    analysisDetails: {
                        totalScore: bestScore,
                        priority: bestPriority,
                        matchedPatterns: bestMatch.matchedPatterns,
                        sources: searchResults.map(r => r.source).join(', '),
                        allAnalysis: analysisDetails,
                        searchResultsCount: searchResults.length
                    }
                };
            }
            
            console.log(`‚ùå Score insuffisant pour classification (meilleur: ${bestScore}, seuil: ${minScore})`);
            return {
                isRDD: false,
                category: null,
                confidence: 'faible',
                description: 'Classification impossible avec les donn√©es disponibles',
                analysisDetails: {
                    bestScore: bestScore,
                    threshold: minScore,
                    allAnalysis: analysisDetails,
                    searchResultsCount: searchResults.length
                }
            };
        }

        function searchEnrichedDatabase(searchTerm) {
            console.log(`üîç Recherche dans la base enrichie: ${searchTerm}`);
            
            const enrichedProducts = {
                // D√©veloppeurs capillaires OXYDANTS (peroxyde d'hydrog√®ne)
                'welloxon': { category: 'Oxydant', description: 'D√©veloppeur capillaire Wella (peroxyde d\'hydrog√®ne)', confidence: '√©lev√©e' },
                'wella welloxon': { category: 'Oxydant', description: 'D√©veloppeur cr√®me Wella (peroxyde d\'hydrog√®ne)', confidence: '√©lev√©e' },
                'welloxon perfect': { category: 'Oxydant', description: 'D√©veloppeur cr√®me parfait Wella (peroxyde d\'hydrog√®ne)', confidence: '√©lev√©e' },
                'volume developer': { category: 'Oxydant', description: 'D√©veloppeur capillaire oxydant', confidence: '√©lev√©e' },
                'cream developer': { category: 'Oxydant', description: 'D√©veloppeur cr√®me (peroxyde d\'hydrog√®ne)', confidence: '√©lev√©e' },
                '10 volume': { category: 'Oxydant', description: 'D√©veloppeur 10 volumes (3% peroxyde)', confidence: '√©lev√©e' },
                '20 volume': { category: 'Oxydant', description: 'D√©veloppeur 20 volumes (6% peroxyde)', confidence: '√©lev√©e' },
                '30 volume': { category: 'Oxydant', description: 'D√©veloppeur 30 volumes (9% peroxyde)', confidence: '√©lev√©e' },
                '40 volume': { category: 'Oxydant', description: 'D√©veloppeur 40 volumes (12% peroxyde)', confidence: '√©lev√©e' },
                'hydrogen peroxide': { category: 'Oxydant', description: 'Peroxyde d\'hydrog√®ne (eau oxyg√©n√©e)', confidence: '√©lev√©e' },
                'peroxyde': { category: 'Oxydant', description: 'Agent oxydant (peroxyde d\'hydrog√®ne)', confidence: '√©lev√©e' },
                'eau oxyg√©n√©e': { category: 'Oxydant', description: 'Peroxyde d\'hydrog√®ne concentr√©', confidence: '√©lev√©e' },
                
                // Marques d√©veloppeurs capillaires
                'ion developer': { category: 'Oxydant', description: 'D√©veloppeur capillaire Ion Sally Beauty', confidence: '√©lev√©e' },
                'clairol developer': { category: 'Oxydant', description: 'D√©veloppeur capillaire Clairol', confidence: '√©lev√©e' },
                'loreal developer': { category: 'Oxydant', description: 'D√©veloppeur capillaire L\'Or√©al', confidence: '√©lev√©e' },
                'schwarzkopf developer': { category: 'Oxydant', description: 'D√©veloppeur capillaire Schwarzkopf', confidence: '√©lev√©e' },
                'revlon developer': { category: 'Oxydant', description: 'D√©veloppeur capillaire Revlon', confidence: '√©lev√©e' },
                
                // Produits silicone et √©tanch√©it√©
                'silicone': { category: 'Organique', description: 'Mastic d\'√©tanch√©it√© √† base de silicone', confidence: '√©lev√©e' },
                'mastic silicone': { category: 'Organique', description: 'Produit d\'√©tanch√©it√© silicone pour joints', confidence: '√©lev√©e' },
                'silicone sealant': { category: 'Organique', description: 'Scellant silicone d\'√©tanch√©it√©', confidence: '√©lev√©e' },
                'caulking': { category: 'Organique', description: 'Produit de calfeutrage √©tanch√©it√©', confidence: 'moyenne' },
                'joint compound': { category: 'Peinture', description: 'Compos√© √† joint gyproc', confidence: 'moyenne' },
                
                // Produits sp√©cialis√©s
                'goo gone': { category: 'Organique', description: 'Enl√®ve-adh√©sifs et r√©sidus collants', confidence: '√©lev√©e' },
                'goof off': { category: 'Organique', description: 'D√©capant multi-usage puissant', confidence: '√©lev√©e' },
                'armor all': { category: 'Organique', description: 'Protectant plastiques et vinyle auto', confidence: '√©lev√©e' },
                'rain-x': { category: 'Organique', description: 'Traitement hydrophobe pare-brise', confidence: '√©lev√©e' },
                'seafoam': { category: 'Organique', description: 'Additif nettoyant moteur', confidence: '√©lev√©e' },
                'marvel mystery oil': { category: 'Huiles', description: 'Additif huile multifonction vintage', confidence: '√©lev√©e' },
                
                // Nettoyants sp√©cialis√©s
                'deck wash': { category: 'Base', description: 'Nettoyant pour terrasse en bois', confidence: '√©lev√©e' },
                'deck brightener': { category: 'Acide', description: '√âclaircissant restaurateur terrasse', confidence: '√©lev√©e' },
                'concrete cleaner': { category: 'Acide', description: 'Nettoyant b√©ton acide', confidence: 'moyenne' },
                'rust converter': { category: 'Acide', description: 'Convertisseur de rouille', confidence: '√©lev√©e' },
                
                // Produits automobiles
                'brake cleaner': { category: 'Organique', description: 'Nettoyant freins d√©graissant', confidence: '√©lev√©e' },
                'carb cleaner': { category: 'Organique', description: 'Nettoyant carburateur', confidence: '√©lev√©e' },
                'starting fluid': { category: 'Combustible', description: 'Liquide de d√©marrage √©ther', confidence: '√©lev√©e' }
            };

            const searchTermLower = searchTerm.toLowerCase().trim();
            
            // Recherche exacte
            if (enrichedProducts[searchTermLower]) {
                console.log(`‚úÖ Correspondance exacte: ${enrichedProducts[searchTermLower].description}`);
                return enrichedProducts[searchTermLower];
            }
            
            // Recherche partielle sophistiqu√©e
            let bestMatch = null;
            let bestScore = 0;
            
            for (const [key, product] of Object.entries(enrichedProducts)) {
                let score = 0;
                const keyWords = key.split(/\s+/);
                const searchWords = searchTermLower.split(/\s+/);
                
                // Score pour correspondance de mots complets
                for (const searchWord of searchWords) {
                    if (searchWord.length > 2) {
                        for (const keyWord of keyWords) {
                            if (keyWord === searchWord) {
                                score += 15; // Correspondance exacte
                            } else if (keyWord.includes(searchWord)) {
                                score += 10; // Contient le mot
                            } else if (searchWord.includes(keyWord)) {
                                score += 8; // Le mot contient la cl√©
                            }
                        }
                    }
                }
                
                // Score pour inclusion de cha√Ænes
                if (searchTermLower.includes(key)) score += 12;
                if (key.includes(searchTermLower)) score += 10;
                
                // Bonus pour correspondances importantes
                if (key.includes('welloxon') && searchTermLower.includes('welloxon')) score += 20;
                if (key.includes('developer') && searchTermLower.includes('developer')) score += 15;
                if (key.includes('volume') && searchTermLower.includes('volume')) score += 10;
                
                if (score > bestScore) {
                    bestScore = score;
                    bestMatch = product;
                }
            }
            
            const minScore = 8; // Seuil minimum
            if (bestMatch && bestScore >= minScore) {
                console.log(`‚úÖ Correspondance partielle (score: ${bestScore}): ${bestMatch.description}`);
                return bestMatch;
            }
            
            console.log(`‚ùå Aucune correspondance suffisante (meilleur score: ${bestScore})`);
            return null;
        }

        function smartClassification(searchTerm) {
            console.log(`üß† Classification intelligente par patterns: ${searchTerm}`);
            
            const text = searchTerm.toLowerCase();
            const patterns = [
                // Patterns pour OXYDANTS (priorit√© maximale)
                { 
                    keywords: ['developer', 'd√©veloppeur', 'welloxon', 'volume', 'peroxide', 'peroxyde', 'hydrogen peroxide', 'eau oxyg√©n√©e', 'oxidant'], 
                    category: 'Oxydant', 
                    description: 'Agent oxydant (peroxyde d\'hydrog√®ne)'
                },
                
                // Patterns pour COMBURANTS
                { 
                    keywords: ['chlore', 'chlorine', 'pool', 'piscine', 'shock', 'hth', 'calcium hypochlorite', 'hypochlorite'], 
                    category: 'Comburants', 
                    description: 'Agent comburant chlor√©'
                },
                
                // Patterns pour TOXIQUES
                { 
                    keywords: ['pesticide', 'herbicide', 'insecticide', 'roundup', 'glyphosate', 'poison', 'toxic', 'rodenticide'], 
                    category: 'Toxique', 
                    description: 'Substance toxique dangereuse'
                },
                
                // Patterns sp√©cialis√©s
                { 
                    keywords: ['silicone', 'mastic', 'sealant', 'caulk', 'joint'], 
                    category: 'Organique', 
                    description: 'Produit d\'√©tanch√©it√©'
                },
                { 
                    keywords: ['raviveur', 'conditionneur', 'restaur', 'brightener'], 
                    category: 'Peinture', 
                    description: 'Produit de restauration'
                },
                { 
                    keywords: ['cleaner', 'nettoyant', 'detergent', 'degreaser'], 
                    category: 'Base', 
                    description: 'Produit nettoyant'
                },
                { 
                    keywords: ['oil', 'huile', 'lubri', 'motor', 'engine', 'brake fluid'], 
                    category: 'Huiles', 
                    description: 'Lubrifiant ou huile'
                },
                { 
                    keywords: ['paint', 'peinture', 'stain', 'teinture', 'primer', 'vernis'], 
                    category: 'Peinture', 
                    description: 'Produit de peinture'
                },
                { 
                    keywords: ['solvent', 'solvant', 'thinner', 'acetone', 'toluene'], 
                    category: 'Organique', 
                    description: 'Solvant organique'
                },
                { 
                    keywords: ['fuel', 'carburant', 'gas', 'essence', 'diesel', 'propane'], 
                    category: 'Combustible', 
                    description: 'Carburant inflammable'
                },
                { 
                    keywords: ['acid', 'acide', 'muriatic', 'sulfuric'], 
                    category: 'Acide', 
                    description: 'Produit acide corrosif'
                },
                { 
                    keywords: ['bleach', 'javellisant', 'ammonia', 'caustic'], 
                    category: 'Base', 
                    description: 'Produit basique corrosif'
                }
            ];
            
            // Recherche avec scoring
            let bestMatch = null;
            let bestScore = 0;
            
            for (const pattern of patterns) {
                let score = 0;
                let matchedKeywords = [];
                
                for (const keyword of pattern.keywords) {
                    if (text.includes(keyword)) {
                        score += keyword.length; // Score bas√© sur la longueur du mot-cl√©
                        matchedKeywords.push(keyword);
                    }
                }
                
                if (score > bestScore) {
                    bestScore = score;
                    bestMatch = {
                        ...pattern,
                        matchedKeywords: matchedKeywords,
                        score: score
                    };
                }
            }
            
            if (bestMatch && bestScore > 0) {
                console.log(`‚úÖ Pattern trouv√©: ${bestMatch.matchedKeywords.join(', ')} ‚Üí ${bestMatch.category} (score: ${bestScore})`);
                return {
                    category: bestMatch.category,
                    description: bestMatch.description + ' (classification par pattern intelligent)'
                };
            }
            
            console.log(`‚ùå Aucun pattern suffisant trouv√©`);
            return null;
        }

        async function autoSearch() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (!searchTerm || isSearching) return;

            if (searchTerm.length < 3) {
                alert('‚ö†Ô∏è Veuillez saisir au moins 3 caract√®res pour la recherche');
                return;
            }

            isSearching = true;
            document.getElementById('searchingFor').textContent = searchTerm;
            document.getElementById('loadingIndicator').style.display = 'block';
            document.getElementById('autoSearchBtn').style.display = 'none';
            document.getElementById('suggestions').style.display = 'none';

            try {
                console.log(`üîç Recherche intelligente multi-niveaux pour: "${searchTerm}"`);
                
                // 1. Base enrichie (plus rapide et pr√©cise)
                let enrichedResult = searchEnrichedDatabase(searchTerm);
                if (enrichedResult) {
                    console.log('‚úÖ Trouv√© dans la base enrichie');
                    const newProduct = createNewProduct(searchTerm, enrichedResult, 'Base enrichie');
                    finalizeProduct(newProduct);
                    return;
                }

                // 2. Recherche web open source
                console.log('üåê Recherche web open source multi-sources...');
                const searchResults = await performRealWebSearch(searchTerm);
                
                if (searchResults.length > 0) {
                    const analysisResult = await analyzeOpenSourceResults(searchTerm, searchResults);
                    
                    if (analysisResult.isRDD && analysisResult.category) {
                        console.log('‚úÖ Classification par recherche web r√©ussie');
                        const newProduct = createNewProduct(searchTerm, analysisResult, 'Recherche web intelligente');
                        newProduct.analysisDetails = analysisResult.analysisDetails;
                        finalizeProduct(newProduct);
                        return;
                    }
                }

                // 3. Classification par patterns (dernier recours)
                console.log('üß† Classification par patterns intelligents...');
                const smartResult = smartClassification(searchTerm);
                
                if (smartResult) {
                    console.log('‚úÖ Classification par patterns r√©ussie');
                    const newProduct = createNewProduct(searchTerm, smartResult, 'Classification par patterns');
                    newProduct.confidence = 'faible';
                    finalizeProduct(newProduct);
                } else {
                    showSearchFailure(searchTerm, searchResults.length);
                }

            } catch (error) {
                console.error('‚ùå Erreur recherche compl√®te:', error);
                alert(`‚ùå Erreur technique lors de la recherche de "${searchTerm}".\n\nD√©tails: ${error.message}\n\nVeuillez r√©essayer ou ajouter le produit manuellement.`);
            } finally {
                document.getElementById('loadingIndicator').style.display = 'none';
                isSearching = false;
            }
        }

        function createNewProduct(searchTerm, result, searchMethod) {
            return {
                name: searchTerm,
                category: result.category,
                description: result.description || `Produit ${result.category.toLowerCase()} (${searchMethod.toLowerCase()})`,
                icon: categoryIcons[result.category],
                autoAdded: true,
                custom: true,
                confidence: result.confidence || 'moyenne',
                searchMethod: searchMethod,
                dateAdded: new Date().toISOString()
            };
        }

        function finalizeProduct(newProduct) {
            // V√©rifier si le produit existe d√©j√†
            const exists = getAllProducts().some(p => 
                p.name.toLowerCase() === newProduct.name.toLowerCase()
            );
            
            if (!exists) {
                customProducts.push(newProduct);
                saveCustomProducts();
                updateCounts();
                displayCategories();
                console.log('‚úÖ Nouveau produit ajout√©:', newProduct);
            }
            
            selectProduct(newProduct);
            document.getElementById('loadingIndicator').style.display = 'none';
            isSearching = false;
        }

        function showSearchFailure(searchTerm, searchResultsCount) {
            const sources = [
                '‚Ä¢ Base de donn√©es enrichie (' + Object.keys({}).length + ' produits sp√©cialis√©s)',
                '‚Ä¢ Wikipedia API (encyclop√©die)',
                '‚Ä¢ DuckDuckGo Instant Answers',
                '‚Ä¢ Bases de donn√©es de s√©curit√© chimique',
                '‚Ä¢ Classification par patterns intelligents'
            ];

            alert(`‚ùå Impossible de classifier "${searchTerm}"

üîç M√©thodes consult√©es:
${sources.join('\n')}

üìä R√©sultats web trouv√©s: ${searchResultsCount}

üí° Suggestions pour am√©liorer la recherche:
‚Ä¢ V√©rifiez l'orthographe du nom
‚Ä¢ Utilisez le nom complet (ex: "Wella Welloxon Perfect 10 Volume")
‚Ä¢ Ajoutez des d√©tails (ex: "d√©veloppeur capillaire", "20 volume")
‚Ä¢ Essayez le nom de la marque
‚Ä¢ Recherchez les ingr√©dients principaux

‚ûï Alternative: Utilisez le bouton "Admin" ‚Üí "Ajouter un produit" pour l'ajouter manuellement.`);
        }

        function displayCategories() {
            const counts = getCategoryCounts();
            const container = document.getElementById('categoriesContainer');
            
            const categoryCards = Object.entries(categoryConfig).map(([category, config]) => {
                const count = counts[category] || 0;
                const icon = categoryIcons[category];
                
                return `
                    <div class="category-card" 
                         style="background: ${config.bg}; border-left-color: ${config.color};"
                         onclick="showCategoryDetails('${category}')"
                         role="listitem"
                         tabindex="0">
                        <div class="category-header">
                            <div class="category-icon" style="background: ${config.color};">
                                ${icon}
                            </div>
                            <div class="category-details">
                                <div class="category-name" style="color: ${config.color};">
                                    ${category}
                                </div>
                                <div class="category-description">${config.desc}</div>
                                <div class="category-count">
                                    <strong>${count}</strong> produit${count !== 1 ? 's' : ''}
                                    ${count > 0 ? '‚Ä¢ Cliquez pour voir la liste' : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = categoryCards;
        }

        function showCategoryDetails(category) {
            const products = getAllProducts().filter(p => p.category === category);
            const config = categoryConfig[category];
            
            if (products.length === 0) {
                alert(`‚ÑπÔ∏è Aucun produit dans la cat√©gorie "${category}" pour le moment.`);
                return;
            }
            
            const productList = products
                .sort((a, b) => a.name.localeCompare(b.name))
                .map(p => `‚Ä¢ ${p.name}${p.custom ? ' (personnalis√©)' : ''}`)
                .join('\n');
            
            alert(`${categoryIcons[category]} CAT√âGORIE: ${category.toUpperCase()}

üìã DESCRIPTION:
${config.desc}

üì¶ PRODUITS (${products.length}):
${productList}

üí° DISPOSITION:
Apportez ces produits √† un √©cocentre ou point de collecte RDD.
Ne jamais jeter aux ordures ou √† l'√©gout.`);
        }

        // Gestion des √©v√©nements et initialisation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initialisation de l\'application Classification RDD...');
            
            try {
                loadCustomProducts();
                updateCounts();
                displayCategories();
                
                // Cacher les suggestions quand on clique ailleurs
                document.addEventListener('click', function(e) {
                    if (!e.target.closest('.search-box')) {
                        document.getElementById('suggestions').style.display = 'none';
                    }
                });

                // Gestion du redimensionnement
                window.addEventListener('resize', function() {
                    const suggestions = document.getElementById('suggestions');
                    if (suggestions.style.display === 'block') {
                        // R√©ajuster la position des suggestions si n√©cessaire
                        setTimeout(() => {
                            const searchBox = document.querySelector('.search-container');
                            const rect = searchBox.getBoundingClientRect();
                            suggestions.style.maxHeight = `${window.innerHeight - rect.bottom - 20}px`;
                        }, 100);
                    }
                });
                
                console.log('‚úÖ Application initialis√©e avec succ√®s');
                console.log(`üìä Base de donn√©es: ${defaultProducts.length} produits par d√©faut + ${customProducts.length} personnalis√©s`);
                console.log('üåê Recherche web multi-sources activ√©e (Wikipedia, DuckDuckGo, Bases s√©curit√©)');
                console.log('üß† Classification intelligente par patterns activ√©e');
                console.log('üíæ Sauvegarde automatique localStorage activ√©e');
                
            } catch (error) {
                console.error('‚ùå Erreur lors de l\'initialisation:', error);
                alert('‚ö†Ô∏è Erreur lors du chargement de l\'application. Certaines fonctionnalit√©s peuvent √™tre limit√©es.');
            }
        });

        // Fonction utilitaire pour le d√©bogage (accessible via console)
        window.RDD_Debug = {
            showStats: function() {
                console.table({
                    'Produits par d√©faut': defaultProducts.length,
                    'Produits personnalis√©s': customProducts.length,
                    'Total': getAllProducts().length,
                    'Cat√©gories': Object.keys(categoryConfig).length
                });
            },
            testSearch: function(term) {
                console.log('üß™ Test de recherche pour:', term);
                const enriched = searchEnrichedDatabase(term);
                const smart = smartClassification(term);
                console.log('Base enrichie:', enriched);
                console.log('Classification intelligente:', smart);
            },
            exportData: function() {
                console.log('üì§ Donn√©es exportables:', {
                    defaultProducts: defaultProducts.length,
                    customProducts: customProducts,
                    categories: categoryConfig
                });
            }
        };

        console.log('üîß Mode debug activ√©. Utilisez window.RDD_Debug pour les outils de d√©veloppement.');
    </script>
</body>
</html>            { name: 'Ammoniaque', category: 'Base', icon: 'ü•Ω', description: 'Nettoyant d√©graissant puissant' },
            { name: 'Soude caustique', category: 'Base', icon: 'ü•Ω', description: 'D√©bouchoir chimique hydroxyde sodium' },
            { name: 'Mr. Clean', category: 'Base', icon: 'ü•Ω', description: 'Nettoyant multi-surfaces alcalin' },
            { name: 'Ajax', category: 'Base', icon: 'ü•Ω', description: 'Nettoyant abrasif d√©graissant' },
            { name: 'Comet', category: 'Base', icon: 'ü•Ω', description: 'Poudre √† r√©curer chlor√©e' },
            { name: 'Drano', category: 'Base', icon: 'ü•Ω', description: 'D√©bouchoir liquide caustique' },
            { name: 'Liquid Plumr', category: 'Base', icon: 'ü•Ω', description: 'D√©bouchoir de drain chimique' },
            { name: 'Easy-Off', category: 'Base', icon: 'ü•Ω', description: 'Nettoyant four tr√®s alcalin' },
            { name: 'Fantastik', category: 'Base', icon: 'ü•Ω', description: 'D√©graissant multi-usage m√©nager' },
            { name: 'Formula 409', category: 'Base', icon: 'ü•Ω', description: 'Nettoyant d√©graissant professionnel' },
            { name: 'Lysol', category: 'Base', icon: 'ü•Ω', description: 'D√©sinfectant surfaces antimicrobien' },
            { name: 'Pine-Sol', category: 'Base', icon: 'ü•Ω', description: 'Nettoyant plancher d√©sinfectant' },
            { name: 'Pledge', category: 'Base', icon: 'ü•Ω', description: 'Polish pour meubles bois' },
            { name: 'Hertel', category: 'Base', icon: 'ü•Ω', description: 'Nettoyant qu√©b√©cois multi-usage' },
            { name: 'Lestoil', category: 'Base', icon: 'ü•Ω', description: 'D√©graissant concentr√© puissant' },
            { name: 'Swiffer', category: 'Base', icon: 'ü•Ω', description: 'Nettoyant plancher parfum√©' },
            { name: 'Febreze', category: 'Base', icon: 'ü•Ω', description: 'Rafra√Æchisseur d\'air neutralisant' },
            { name: 'Vim', category: 'Base', icon: 'ü•Ω', description: 'Nettoyant abrasif cr√®me' },
            { name: 'Green Works', category: 'Base', icon: 'ü•Ω', description: 'Nettoyants √©cologiques Clorox' },
            { name: 'Windex', category: 'Base', icon: 'ü•Ω', description: 'Nettoyant √† vitre ammoniacal' },
            { name: 'Tilex', category: 'Base', icon: 'ü•Ω', description: 'Nettoyant moisissure chlor√©' },
            { name: 'Scrubbing Bubbles', category: 'Base', icon: 'ü•Ω', description: 'Nettoyant salle de bain moussant' },

            // TOXIQUES (45 produits)
            { name: 'Roundup', category: 'Toxique', icon: '‚ò†Ô∏è', description: 'Herbicide glyphosate syst√©mique' },
            { name: 'Raid', category: 'Toxique', icon: '‚ò†Ô∏è', description: 'Insecticide en a√©rosol domestique' },
            { name: 'Mort-aux-rats', category: 'Toxique', icon: '‚ò†Ô∏è', description: 'Rodenticide anticoagulant poison' },
            { name: 'Anti-limace', category: 'Toxique', icon: '‚ò†Ô∏è', description: 'Molluscicide m√©tald√©hyde pellets' },
            { name: 'Antigel', category: 'Toxique', icon: '‚ò†Ô∏è', description: '√âthyl√®ne glycol liquide refroidissement' },
            { name: 'Varsol', category: 'Toxique', icon: '‚ò†Ô∏è', description: 'Solvant min√©ral petroleum distill√©' },
            { name: 'Baygon', category: 'Toxique', icon: '‚ò†Ô∏è', description: 'Insecticide domestique carbamate' },
            { name: 'OFF!', category: 'Toxique', icon: '‚ò†Ô∏è', description: 'Chasse-moustiques DEET concentr√©' },
            { name: 'Killex', category: 'Toxique', icon: '‚ò†Ô∏è', description: 'Herbicide pelouse 2,4-D' },
            { name: 'M√©thanol', category: 'Toxique', icon: '‚ò†Ô∏è', description: 'Alcool m√©thylique combustible carburant' },
            { name: 'D-Con', category: 'Toxique', icon: '‚ò†Ô∏è', description: 'Poison souris rats brodifacoum' },
            { name: 'Warfarine', category: 'Toxique', icon: '‚ò†Ô∏è', description: 'Rodenticide anticoagulant m√©dical' },

            // PEINTURES (70 produits)
            { name: 'Peinture latex', category: 'Peinture', icon: 'üé®', description: 'Peinture √† base d\'eau acrylique' },
            { name: 'Peinture alkyde', category: 'Peinture', icon: 'üé®', description: 'Peinture √† l\'huile synth√©tique' },
            { name: 'Benjamin Moore', category: 'Peinture', icon: 'üé®', description: 'Peinture murale haut de gamme' },
            { name: 'Primer', category: 'Peinture', icon: 'üé®', description: 'Appr√™t sous-couche pr√©paration' },
            { name: 'Teinture √† bois', category: 'Peinture', icon: 'üé®', description: 'Colorant p√©n√©trant bois ext√©rieur' },
            { name: 'Sherwin Williams', category: 'Peinture', icon: 'üé®', description: 'Peinture architecturale professionnelle' },
            { name: 'Dulux', category: 'Peinture', icon: 'üé®', description: 'Peinture d√©corative premium' },
            { name: 'Behr', category: 'Peinture', icon: 'üé®', description: 'Peinture Home Depot marque maison' },
            { name: 'Sico', category: 'Peinture', icon: 'üé®', description: 'Peinture d√©corative qu√©b√©coise' },
            { name: 'Arborcoat', category: 'Peinture', icon: 'üé®', description: 'Teinture semi-transparente Benjamin Moore' },
            { name: 'Minwax', category: 'Peinture', icon: 'üé®', description: 'Teinture et vernis bois int√©rieur' },
            { name: 'Varathane', category: 'Peinture', icon: 'üé®', description: 'Vernis polyur√©thane plancher' },
            { name: 'Tremclad', category: 'Peinture', icon: 'üé®', description: 'Peinture antirouille m√©tal direct' },
            { name: 'Rust-Oleum', category: 'Peinture', icon: 'üé®', description: 'Peinture m√©taux sp√©cialis√©e' },
            { name: 'Krylon', category: 'Peinture', icon: 'üé®', description: 'Peinture en a√©rosol s√©chage rapide' },
            { name: 'Paint Stripper', category: 'Peinture', icon: 'üé®', description: 'D√©capant chimique m√©thyl√®ne chlorure' },

            // HUILES (35 produits)
            { name: 'Huile moteur', category: 'Huiles', icon: 'üõ¢Ô∏è', description: 'Lubrifiant automobile viscosit√© variable' },
            { name: 'WD-40', category: 'Huiles', icon: 'üõ¢Ô∏è', description: 'D√©grippant lubrifiant p√©n√©trant' },
            { name: 'Castrol', category: 'Huiles', icon: 'üõ¢Ô∏è', description: 'Huile moteur synth√©tique haute performance' },
            { name: 'Mobil 1', category: 'Huiles', icon: 'üõ¢Ô∏è', description: 'Huile synth√©tique longue dur√©e' },
            { name: 'Valvoline', category: 'Huiles', icon: 'üõ¢Ô∏è', description: 'Huile moteur conventionnelle standard' },
            { name: 'Huile hydraulique', category: 'Huiles', icon: 'üõ¢Ô∏è', description: 'Fluide de transmission pression' },
            { name: 'Brake Fluid', category: 'Huiles', icon: 'üõ¢Ô∏è', description: 'Liquide de frein DOT 3/4' },
            { name: 'Coolant', category: 'Huiles', icon: 'üõ¢Ô∏è', description: 'Liquide de refroidissement √©thyl√®ne glycol' },
            { name: 'ATF', category: 'Huiles', icon: 'üõ¢Ô∏è', description: 'Fluide transmission automatique Dexron' },

            // ORGANIQUES (40 produits)
            { name: 'Ac√©tone', category: 'Organique', icon: 'üß¥', description: 'Dissolvant pour vernis √† ongles' },
            { name: 'Essence min√©rale', category: 'Organique', icon: 'üß¥', description: 'Solvant pour peinture diluant' },
            { name: 'T√©r√©benthine', category: 'Organique', icon: 'üß¥', description: 'Diluant naturel r√©sine pin' },
            { name: 'Tolu√®ne', category: 'Organique', icon: 'üß¥', description: 'Solvant industriel aromatique' },
            { name: 'Alcool isopropylique', category: 'Organique', icon: 'üß¥', description: 'Alcool √† friction d√©sinfectant' },
            { name: 'GM-20', category: 'Organique', icon: 'üß¥', description: 'Enzyme concentr√© pour fosses septiques' },
            { name: 'Silicone', category: 'Organique', icon: 'üß¥', description: 'Mastic d\'√©tanch√©it√© √©lastom√®re' },
            { name: 'Xyl√®ne', category: 'Organique', icon: 'üß¥', description: 'Solvant peinture nettoyant puissant' },

            // COMBUSTIBLES (25 produits)
            { name: 'Essence', category: 'Combustible', icon: '‚õΩ', description: 'Carburant automobile octane √©lev√©' },
            { name: 'Diesel', category: 'Combustible', icon: '‚õΩ', description: 'Gazole combustible moteur diesel' },
            { name: 'Propane', category: 'Combustible', icon: '‚õΩ', description: 'Gaz de p√©trole liqu√©fi√© BBQ' },
            { name: 'K√©ros√®ne', category: 'Combustible', icon: '‚õΩ', description: 'Combustible de chauffage lampe' },
            { name: 'Mazout', category: 'Combustible', icon: '‚õΩ', description: 'Fuel oil domestique chauffage' },
            { name: 'Butane', category: 'Combustible', icon: '‚õΩ', description: 'Gaz combustible briquet' },

            // COMBURANTS (20 produits)
            { name: 'Chlore piscine', category: 'Comburants', icon: 'üí•', description: 'Pastilles hypochlorite calcium d√©sinfection' },
            { name: 'HTH', category: 'Comburants', icon: 'üí•', description: 'Hypochlorite de calcium choc piscine' },
            { name: 'Pool Shock', category: 'Comburants', icon: 'üí•', description: 'Choc chlor√© piscine super concentration' },
            { name: 'Bromine', category: 'Comburants', icon: 'üí•', description: 'D√©sinfectant spa brome pastilles' },

            // OXYDANTS (15 produits) - CORRECTION IMPORTANTE
            { name: 'Peroxyde d\'hydrog√®ne', category: 'Oxydant', icon: 'üí•', description: 'Eau oxyg√©n√©e concentr√©e 35%' },
            { name: 'Oxyclean', category: 'Oxydant', icon: 'üí•', description: 'D√©tachant oxyg√©n√© percarbonate sodium' },
            { name: 'Clorox 2', category: 'Oxydant', icon: 'üí•', description: 'Javellisant color√© peroxyde hydrog√®ne' },
            { name: 'Welloxon Perfect', category: 'Oxydant', icon: 'üí•', description: 'D√©veloppeur capillaire Wella peroxyde hydrog√®ne' },
            { name: 'Wella Welloxon 10 Volume', category: 'Oxydant', icon: 'üí•', description: 'D√©veloppeur 3% peroxyde hydrog√®ne' },
            { name: 'Wella Welloxon 20 Volume', category: 'Oxydant', icon: 'üí•', description: 'D√©veloppeur 6% peroxyde hydrog√®ne' },
            { name: 'Wella Welloxon 30 Volume', category: 'Oxydant', icon: 'üí•', description: 'D√©veloppeur 9% peroxyde hydrog√®ne' },
            { name: 'Wella Welloxon 40 Volume', category: 'Oxydant', icon: 'üí•', description: 'D√©veloppeur 12% peroxyde hydrog√®ne' },
            { name: 'L\'Or√©al Developer', category: 'Oxydant', icon: 'üí•', description: 'D√©veloppeur capillaire L\'Or√©al' },
            { name: 'Clairol Developer', category: 'Oxydant', icon: 'üí•', description: 'D√©veloppeur capillaire Clairol' },
            { name: 'Ion Developer', category: 'Oxydant', icon: 'üí•', description: 'D√©veloppeur capillaire Ion Sally Beauty' }
        ];

        // Variables globales
        let customProducts = [];
        let isSearching = false;
        let selectedProduct = null;

        // Configuration des cat√©gories
        const categoryConfig = {
            'Acide': { color: '#dc2626', bg: '#fef2f2', desc: 'Substances corrosives acides (pH < 7)' },
            'Base': { color: '#2563eb', bg: '#eff6ff', desc: 'Substances corrosives basiques (pH > 7)' },
            'Comburants': { color: '#ea580c', bg: '#fff7ed', desc: 'Substances favorisant la combustion (chlore, hypochlorite)' },
            'Oxydant': { color: '#eab308', bg: '#fefce8', desc: 'Agents oxydants (peroxyde d\'hydrog√®ne, d√©veloppeurs capillaires)' },
            'Toxique': { color: '#7c3aed', bg: '#faf5ff', desc: 'Substances toxiques et v√©n√©neuses (pesticides, poisons)' },
            'Peinture': { color: '#059669', bg: '#f0fdf4', desc: 'Peintures, teintures, vernis et solvants associ√©s' },
            'Huiles': { color: '#4b5563', bg: '#f9fafb', desc: 'Huiles usag√©es et lubrifiants (moteur, hydraulique)' },
            'Organique': { color: '#0d9488', bg: '#f0fdfa', desc: 'Solvants organiques (ac√©tone, tolu√®ne, essence min√©rale)' },
            'Combustible': { color: '#dc2626', bg: '#fef2f2', desc: 'Liquides inflammables (essence, propane, diesel)' }
        };

        const categoryIcons = {
            'Acide': 'üß™', 'Base': 'ü•Ω', 'Comburants': 'üí•', 'Oxydant': 'üí•',
            'Toxique': '‚ò†Ô∏è', 'Peinture': 'üé®', 'Huiles': 'üõ¢Ô∏è',
            'Organique': 'üß¥', 'Combustible': '‚õΩ'
        };

        // Fonctions utilitaires
        function getAllProducts() {
            return [...defaultProducts, ...customProducts];
        }

        function loadCustomProducts() {
            try {
                const stored = localStorage.getItem('rdd_custom_products');
                if (stored) {
                    customProducts = JSON.parse(stored);
                    console.log(`üì¶ ${customProducts.length} produits personnalis√©s charg√©s`);
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Erreur chargement localStorage:', error);
                customProducts = [];
            }
        }

        function saveCustomProducts() {
            try {
                localStorage.setItem('rdd_custom_products', JSON.stringify(customProducts));
                console.log(`üíæ ${customProducts.length} produits personnalis√©s sauvegard√©s`);
            } catch (error) {
                console.warn('‚ö†Ô∏è Erreur sauvegarde localStorage:', error);
            }
        }

        function updateCounts() {
            const total = getAllProducts().length;
            document.getElementById('defaultCount').textContent = defaultProducts.length;
            document.getElementById('customCount').textContent = customProducts.length;
            document.getElementById('totalCount').textContent = total;
            document.getElementById('footerTotal').textContent = total;
            
            const footerCustom = document.getElementById('footerCustom');
            if (customProducts.length > 0) {
                footerCustom.textContent = ` (${customProducts.length} personnalis√©s)`;
                footerCustom.style.color = '#059669';
                footerCustom.style.fontWeight = '600';
            } else {
                footerCustom.textContent = '';
            }
        }

        function getCategoryCounts() {
            const counts = {};
            getAllProducts().forEach(product => {
                counts[product.category] = (counts[product.category] || 0) + 1;
            });
            return counts;
        }

        // Fonctions principales
        function toggleAdmin() {
            const panel = document.getElementById('adminPanel');
            const isHidden = panel.style.display === 'none' || panel.style.display === '';
            panel.style.display = isHidden ? 'block' : 'none';
            
            if (!isHidden) {
                // Fermer le formulaire d'ajout si ouvert
                document.getElementById('addProductForm').style.display = 'none';
            }
        }

        function toggleAddProduct() {
            const form = document.getElementById('addProductForm');
            const isHidden = form.style.display === 'none' || form.style.display === '';
            form.style.display = isHidden ? 'block' : 'none';
            
            if (isHidden) {
                // Focus sur le premier champ
                document.getElementById('newProductName').focus();
            }
        }

        function addProduct() {
            const name = document.getElementById('newProductName').value.trim();
            const category = document.getElementById('newProductCategory').value;
            const description = document.getElementById('newProductDesc').value.trim();

            if (!name || !description) {
                alert('‚ö†Ô∏è Veuillez remplir tous les champs obligatoires');
                return;
            }

            // V√©rifier si le produit existe d√©j√†
            const exists = getAllProducts().some(p => 
                p.name.toLowerCase() === name.toLowerCase()
            );
            
            if (exists) {
                alert(`‚ö†Ô∏è Le produit "${name}" existe d√©j√† dans la base de donn√©es`);
                return;
            }

            const newProduct = {
                name: name,
                category: category,
                description: description,
                icon: categoryIcons[category],
                custom: true,
                dateAdded: new Date().toISOString()
            };

            customProducts.push(newProduct);
            saveCustomProducts();
            updateCounts();
            displayCategories();

            // Reset form
            document.getElementById('newProductName').value = '';
            document.getElementById('newProductDesc').value = '';
            toggleAddProduct();

            alert(`‚úÖ Produit "${name}" ajout√© avec succ√®s dans la cat√©gorie ${category}!`);
            console.log('‚ûï Nouveau produit ajout√©:', newProduct);
        }

        function exportDatabase() {
            const timestamp = new Date().toISOString().split('T')[0];
            const dataToExport = {
                version: '2.0',
                exportDate: new Date().toISOString(),
                totalProducts: getAllProducts().length,
                defaultProducts: defaultProducts.length,
                customProducts: customProducts,
                categories: Object.keys(categoryConfig),
                metadata: {
                    appName: 'Classification RDD',
                    author: 'PaT\'s_PrOjEcT\'s',
                    website: 'https://github.com/pats-projects'
                }
            };

            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `classification-rdd-backup-${timestamp}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            console.log('üì§ Base de donn√©es export√©e:', dataToExport);
            alert(`üì§ Base de donn√©es export√©e avec succ√®s!\nFichier: classification-rdd-backup-${timestamp}.json`);
        }

        function handleSearch() {
            const input = document.getElementById('searchInput');
            const query = input.value.toLowerCase().trim();
            const suggestionsDiv = document.getElementById('suggestions');
            const autoSearchBtn = document.getElementById('autoSearchBtn');
            
            if (query.length === 0) {
                suggestionsDiv.style.display = 'none';
                autoSearchBtn.style.display = 'none';
                return;
            }

            const filtered = getAllProducts().filter(product => 
                product.name.toLowerCase().includes(query) ||
                product.description.toLowerCase().includes(query)
            ).slice(0, 8); // Augment√© √† 8 r√©sultats

            if (filtered.length === 0) {
                if (query.length > 2) {
                    suggestionsDiv.innerHTML = `
                        <div class="no-results">
                            <strong>Aucun produit trouv√©</strong><br>
                            Cliquez sur <strong>üåê Web</strong> pour rechercher en ligne
                        </div>
                    `;
                    suggestionsDiv.style.display = 'block';
                    autoSearchBtn.style.display = 'block';
                } else {
                    suggestionsDiv.style.display = 'none';
                    autoSearchBtn.style.display = 'none';
                }
                return;
            }

            suggestionsDiv.innerHTML = filtered.map(product => `
                <div class="suggestion" onclick="selectProduct(${JSON.stringify(product).replace(/"/g, '&quot;')})" role="option">
                    <div class="suggestion-content">
                        <div class="suggestion-icon">${product.icon}</div>
                        <div class="suggestion-info">
                            <div class="suggestion-name">${highlightMatch(product.name, query)}</div>
                            <div class="suggestion-desc">${highlightMatch(product.description, query)}</div>
                            <div class="suggestion-badges">
                                <div class="suggestion-category category-${product.category.toLowerCase()}">${product.category}</div>
                                ${product.autoAdded ? '<span class="auto-added-badge">Auto-ajout√©</span>' : ''}
                                ${product.custom ? '<span class="auto-added-badge">Personnalis√©</span>' : ''}
                                ${product.searchMethod ? `<span class="search-method-badge">${product.searchMethod}</span>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            suggestionsDiv.style.display = 'block';
            autoSearchBtn.style.display = query.length > 2 ? 'block' : 'none';
        }

        function highlightMatch(text, query) {
            if (!query || query.length < 2) return text;
            const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\')})`, 'gi');
            return text.replace(regex, '<strong>$1</strong>');
        }

        function selectProduct(product) {
            selectedProduct = product;
            document.getElementById('searchInput').value = product.name;
            document.getElementById('suggestions').style.display = 'none';
            document.getElementById('autoSearchBtn').style.display = 'none';
            showSelectedProduct(product);
            
            // Scroll vers le r√©sultat
            document.getElementById('resultBox').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'nearest' 
            });
        }

        function showSelectedProduct(product) {
            const config = categoryConfig[product.category];
            const resultBox = document.getElementById('resultBox');
            
            // Cr√©er les badges
            const badges = [];
            if (product.autoAdded) badges.push('<span class="auto-added-result">‚ú® Auto-ajout√©</span>');
            if (product.custom) badges.push('<span class="auto-added-result">üë§ Personnalis√©</span>');
            if (product.confidence) badges.push(`<span class="confidence-badge confidence-${product.confidence}">Confiance: ${product.confidence}</span>`);
            if (product.searchMethod) badges.push(`<span class="search-method-badge">${product.searchMethod}</span>`);
            
            resultBox.innerHTML = `
                <div class="result-header">
                    <div class="result-icon">${product.icon}</div>
                    <div class="result-info">
                        <div class="result-name">${product.name}</div>
                        <div class="result-desc">${product.description}</div>
                        <div class="result-badges">
                            ${badges.join('')}
                        </div>
                    </div>
                </div>
                <div class="classification">
                    <div class="classification-title">
                        <span>üìä</span>
                        <span>Classification RDD:</span>
                    </div>
                    <div class="classification-badge" style="background: ${config.color}">
                        ${product.icon} ${product.category}
                    </div>
                    <div class="classification-desc">${config.desc}</div>
                    <div class="instructions">
                        <div class="instructions-title">
                            üí° Instructions de disposition
                        </div>
                        <div class="instructions-text">
                            <strong>√Ä faire:</strong> Apportez ce produit √† un √©cocentre ou point de collecte de r√©sidus domestiques dangereux de votre r√©gion.<br>
                            <strong>Interdit:</strong> Ne jamais jeter aux ordures m√©nag√®res, √† l'√©gout ou dans l'environnement.
                        </div>
                    </div>
                </div>
            `;
            
            resultBox.style.display = 'block';
            console.log('üìã Produit s√©lectionn√©:', product);
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const searchTerm = document.getElementById('searchInput').value.trim();
                if (!searchTerm) return;
                
                const allProducts = getAllProducts();
                const exactMatch = allProducts.find(product => 
                    product.name.toLowerCase() === searchTerm.toLowerCase()
                );
                
                if (exactMatch) {
                    selectProduct(exactMatch);
                } else {
                    const suggestions = allProducts.filter(product =>
                        product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        product.description.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                    
                    if (suggestions.length > 0) {
                        selectProduct(suggestions[0]);
                    } else {
                        autoSearch();
                    }
                }
            }
        }

        // RECHERCHE WEB OPEN SOURCE OPTIMIS√âE
        async function performRealWebSearch(searchTerm) {
            console.log(`üåê Recherche web open source pour: ${searchTerm}`);
            const searchResults = [];
            
            // 1. Recherche Wikipedia (API officielle, pas de CORS)
            try {
                console.log('üìñ Recherche Wikipedia...');
                const wikiUrl = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(searchTerm)}`;
                const wikiResponse = await fetch(wikiUrl);
                
                if (wikiResponse.ok) {
                    const wikiData = await wikiResponse.json();
                    if (wikiData.extract && wikiData.extract.length > 50) {
                        searchResults.push({
                            source: 'Wikipedia',
                            title: wikiData.title,
                            content: wikiData.extract,
                            url: wikiData.content_urls?.desktop?.page || '',
                            confidence: '√©lev√©e'
                        });
                        console.log('‚úÖ Wikipedia trouv√©:', wikiData.title);
                    }
                }
            } catch (error) {
                console.log('‚ùå Wikipedia √©chou√©:', error.message);
            }
            
            // 2. Recherche DuckDuckGo avec proxies CORS fiables
            const corsProxies = [
                'https://api.allorigins.win/get?url=',
                'https://corsproxy.io/?',
                'https://api.codetabs.com/v1/proxy?quest='
            ];
            
            const searchQueries = [
                `${searchTerm} chemical safety MSDS`,
                <!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classification RDD par PaT's_PrOjEcT's</title>
    <meta name="description" content="Application de classification des r√©sidus domestiques dangereux avec recherche web intelligente">
    <meta name="keywords" content="RDD, r√©sidus domestiques dangereux, classification, environnement, recyclage">
    <meta name="author" content="PaT's_PrOjEcT's">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üß™</text></svg>">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            line-height: 1.6;
            color: #333;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .header {
            background: linear-gradient(135deg, #059669, #047857);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .header .subtitle {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 3px;
        }
        
        .header .description {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .admin-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }
        
        .admin-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .admin-panel {
            background: #f3f4f6;
            border-bottom: 2px solid #d1d5db;
            padding: 15px;
            display: none;
        }
        
        .admin-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #374151;
        }
        
        .admin-buttons {
            display: grid;
            gap: 10px;
        }
        
        .admin-btn-full {
            padding: 12px 15px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-size: 14px;
        }
        
        .btn-blue {
            background: #3b82f6;
            color: white;
        }
        
        .btn-blue:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        
        .btn-green {
            background: #059669;
            color: white;
        }
        
        .btn-green:hover {
            background: #047857;
            transform: translateY(-1px);
        }
        
        .btn-gray {
            background: #6b7280;
            color: white;
        }
        
        .btn-gray:hover {
            background: #4b5563;
            transform: translateY(-1px);
        }
        
        .stats-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            color: #6b7280;
            border: 1px solid #e5e7eb;
        }
        
        .stats-title {
            font-weight: 600;
            color: #111827;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stats-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
        }
        
        .web-status {
            margin-top: 10px;
            padding: 8px;
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 6px;
            font-size: 12px;
            color: #059669;
            text-align: center;
        }
        
        .add-product-form {
            background: #eff6ff;
            border-bottom: 2px solid #93c5fd;
            padding: 15px;
            display: none;
        }
        
        .form-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #1e40af;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 5px;
        }
        
        .form-input, .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }
        
        .search-box {
            padding: 15px;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .search-container {
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 14px 15px 14px 45px;
            border: 2px solid #d1d5db;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #059669;
            box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
            transform: translateY(-1px);
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            width: 20px;
            height: 20px;
        }
        
        .auto-search-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            display: none;
            font-weight: 500;
        }
        
        .auto-search-btn:hover {
            background: #2563eb;
            transform: translateY(-50%) scale(1.05);
        }
        
        .loading-indicator {
            margin-top: 12px;
            text-align: center;
            display: none;
        }
        
        .loading-box {
            background: #dbeafe;
            border: 1px solid #93c5fd;
            border-radius: 8px;
            padding: 15px;
        }
        
        .loading-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .loading-spinner {
            width: 18px;
            height: 18px;
            border: 2px solid #3b82f6;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #1d4ed8;
            font-size: 14px;
            font-weight: 500;
        }
        
        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 10px;
            margin-top: 5px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            z-index: 10;
            max-height: 350px;
            overflow-y: auto;
            display: none;
        }
        
        .suggestion {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: background 0.2s;
        }
        
        .suggestion:hover {
            background: #f9fafb;
        }
        
        .suggestion:last-child {
            border-bottom: none;
        }
        
        .suggestion-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .suggestion-icon {
            font-size: 20px;
            min-width: 24px;
        }
        
        .suggestion-info {
            flex: 1;
            min-width: 0;
        }
        
        .suggestion-name {
            font-weight: 500;
            margin-bottom: 3px;
            color: #111827;
        }
        
        .suggestion-desc {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 5px;
            line-height: 1.4;
        }
        
        .suggestion-badges {
            display: flex;
            gap: 6px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .suggestion-category {
            display: inline-block;
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .auto-added-badge, .search-method-badge {
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .auto-added-badge {
            background: #dcfce7;
            color: #166534;
        }
        
        .search-method-badge {
            background: #e0e7ff;
            color: #3730a3;
        }
        
        /* Couleurs des cat√©gories */
        .category-acide { background: #dc2626; }
        .category-base { background: #2563eb; }
        .category-toxique { background: #7c3aed; }
        .category-peinture { background: #059669; }
        .category-huiles { background: #4b5563; }
        .category-organique { background: #0d9488; }
        .category-combustible { background: #dc2626; }
        .category-comburants { background: #ea580c; }
        .category-oxydant { background: #eab308; }
        
        .result-box {
            margin: 15px;
            padding: 18px;
            background: #f0fdf4;
            border: 2px solid #bbf7d0;
            border-radius: 12px;
            display: none;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 18px;
        }
        
        .result-icon {
            font-size: 36px;
            min-width: 40px;
        }
        
        .result-info {
            flex: 1;
            min-width: 0;
        }
        
        .result-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 6px;
            color: #111827;
        }
        
        .result-desc {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .result-badges {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .auto-added-result {
            background: #dcfce7;
            color: #166534;
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 500;
        }
        
        .confidence-badge {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .confidence-√©lev√©e {
            background: #dcfce7;
            color: #166534;
        }
        
        .confidence-moyenne {
            background: #fef3c7;
            color: #92400e;
        }
        
        .confidence-faible {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .classification {
            background: white;
            padding: 18px;
            border-radius: 10px;
            border-left: 4px solid #059669;
        }
        
        .classification-title {
            font-weight: bold;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #111827;
        }
        
        .classification-badge {
            display: inline-block;
            padding: 10px 16px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            margin-bottom: 12px;
            font-size: 15px;
        }
        
        .classification-desc {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .instructions {
            background: #fefce8;
            border: 1px solid #fde047;
            padding: 15px;
            border-radius: 8px;
        }
        
        .instructions-title {
            font-weight: bold;
            color: #a16207;
            font-size: 14px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .instructions-text {
            font-size: 13px;
            color: #a16207;
            line-height: 1.5;
        }
        
        .categories {
            padding: 15px;
        }
        
        .categories h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .category-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .category-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .category-header {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .category-icon {
            font-size: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .category-details {
            flex: 1;
            min-width: 0;
        }
        
        .category-name {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 15px;
        }
        
        .category-description {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 4px;
            line-height: 1.4;
        }
        
        .category-count {
            font-size: 12px;
            color: #9ca3af;
            font-weight: 500;
        }
        
        .footer {
            background: #f3f4f6;
            padding: 20px 15px;
            text-align: center;
            color: #6b7280;
            font-size: 14px;
            border-top: 1px solid #e5e7eb;
        }
        
        .footer p {
            margin-bottom: 6px;
        }
        
        .footer .copyright {
            font-size: 12px;
            color: #9ca3af;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #d1d5db;
        }
        
        .no-results {
            text-align: center;
            padding: 25px;
            color: #6b7280;
            font-style: italic;
            line-height: 1.6;
        }

        .no-results strong {
            color: #374151;
            font-weight: 600;
        }
        
        /* Responsive */
        @media (max-width: 480px) {
            .container {
                max-width: 100%;
                margin: 0;
                box-shadow: none;
            }
            
            .header {
                border-radius: 0;
            }
            
            .search-input {
                font-size: 16px; /* √âvite le zoom sur iOS */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üß™ Classification RDD</h1>
            <p class="subtitle">par PaT's_PrOjEcT's</p>
            <p class="description">R√©sidus domestiques dangereux</p>
            <button class="admin-btn" onclick="toggleAdmin()" aria-label="Panneau d'administration">‚öôÔ∏è Admin</button>
        </div>

        <!-- Admin Panel -->
        <div class="admin-panel" id="adminPanel" role="region" aria-label="Panneau d'administration">
            <div class="admin-title">‚öôÔ∏è Panneau d'administration</div>
            <div class="admin-buttons">
                <button class="admin-btn-full btn-blue" onclick="toggleAddProduct()">‚ûï Ajouter un produit</button>
                <button class="admin-btn-full btn-green" onclick="exportDatabase()">üì§ Exporter ma base de donn√©es</button>
                <div class="stats-box">
                    <div class="stats-title">
                        üìä Statistiques
                    </div>
                    <div class="stats-item">
                        <span>‚Ä¢ Produits par d√©faut:</span>
                        <strong><span id="defaultCount">0</span></strong>
                    </div>
                    <div class="stats-item">
                        <span>‚Ä¢ Produits personnalis√©s:</span>
                        <strong><span id="customCount">0</span></strong>
                    </div>
                    <div class="stats-item">
                        <span>‚Ä¢ Total:</span>
                        <strong><span id="totalCount">0</span></strong>
                    </div>
                    <div class="web-status">
                        üåê Recherche web open source active<br>
                        <small>Wikipedia ‚Ä¢ PubChem ‚Ä¢ DuckDuckGo</small>
                    </div>
                    <div class="copyright">¬© 2025 PaT's_PrOjEcT's</div>
                </div>
            </div>
        </div>

        <!-- Add Product Form -->
        <div class="add-product-form" id="addProductForm" role="form" aria-label="Formulaire d'ajout de produit">
            <h3 class="form-title">‚ûï Ajouter un nouveau produit</h3>
            <div class="form-group">
                <label class="form-label" for="newProductName">Nom du produit *</label>
                <input type="text" class="form-input" id="newProductName" placeholder="Ex: WD-40, Roundup, Welloxon..." required>
            </div>
            <div class="form-group">
                <label class="form-label" for="newProductCategory">Cat√©gorie RDD *</label>
                <select class="form-select" id="newProductCategory" required>
                    <option value="Acide">üß™ Acide</option>
                    <option value="Base">ü•Ω Base</option>
                    <option value="Comburants">üí• Comburants</option>
                    <option value="Oxydant">üí• Oxydant</option>
                    <option value="Toxique">‚ò†Ô∏è Toxique</option>
                    <option value="Peinture">üé® Peinture</option>
                    <option value="Huiles">üõ¢Ô∏è Huiles</option>
                    <option value="Organique">üß¥ Organique</option>
                    <option value="Combustible">‚õΩ Combustible</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="newProductDesc">Description *</label>
                <input type="text" class="form-input" id="newProductDesc" placeholder="Ex: D√©grippant lubrifiant, Herbicide glyphosate..." required>
            </div>
            <div class="form-buttons">
                <button class="admin-btn-full btn-green" onclick="addProduct()" type="button">‚úÖ Ajouter</button>
                <button class="admin-btn-full btn-gray" onclick="toggleAddProduct()" type="button">‚ùå Annuler</button>
            </div>
        </div>

        <!-- Search -->
        <div class="search-box">
            <div class="search-container">
                <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <input type="text" class="search-input" id="searchInput" 
                       placeholder="Rechercher un produit (ex: Wella Welloxon, Roundup, WD-40...)" 
                       oninput="handleSearch()" onkeypress="handleKeyPress(event)"
                       aria-label="Rechercher un produit chimique">
                <button class="auto-search-btn" id="autoSearchBtn" onclick="autoSearch()" aria-label="Recherche web">üåê Web</button>
            </div>
            
            <div class="loading-indicator" id="loadingIndicator" role="status" aria-live="polite">
                <div class="loading-box">
                    <div class="loading-content">
                        <div class="loading-spinner" aria-hidden="true"></div>
                        <span class="loading-text">Recherche intelligente de "<span id="searchingFor"></span>"...</span>
                    </div>
                </div>
            </div>

            <div class="suggestions" id="suggestions" role="listbox" aria-label="Suggestions de produits"></div>
        </div>

        <!-- Selected Product Result -->
        <div class="result-box" id="resultBox" role="region" aria-label="R√©sultat de classification"></div>

        <!-- Categories -->
        <div class="categories">
            <h2>
                <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                </svg>
                Cat√©gories de disposition
            </h2>
            <div id="categoriesContainer" role="list"></div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p><strong>üå± Classification RDD par PaT's_PrOjEcT's</strong></p>
            <p>Classification intelligente des r√©sidus domestiques dangereux</p>
            <p>
                Base de donn√©es: <strong><span id="footerTotal">0</span> produits</strong>
                <span id="footerCustom"></span>
            </p>
            <p class="copyright">
                D√©velopp√© avec ‚ù§Ô∏è par PaT's_PrOjEcT's ¬© 2025<br>
                <small>Open source ‚Ä¢ Recherche web intelligente ‚Ä¢ √âcologique</small>
            </p>
        </div>
    </div>

    <script>
        'use strict';

        // Base de donn√©es des produits par d√©faut (version compl√®te)
        const defaultProducts = [
            // ACIDES (50 produits)
            { name: 'Acide muriatique', category: 'Acide', icon: 'üß™', description: 'Nettoyant pour piscine, acide chlorhydrique concentr√©' },
            { name: 'Vinaigre blanc concentr√©', category: 'Acide', icon: 'üß™', description: 'Nettoyant m√©nager acide, d√©tartrant naturel' },
            { name: 'D√©tartrant WC', category: 'Acide', icon: 'üß™', description: 'Nettoyant sanitaire acide fort' },
            { name: 'Acide sulfurique', category: 'Acide', icon: 'üß™', description: '√âlectrolyte de batterie, tr√®s corrosif' },
            { name: 'CLR', category: 'Acide', icon: 'üß™', description: 'Nettoyant calcium, lime, rouille' },
            { name: 'Lime Away', category: 'Acide', icon: 'üß™', description: 'D√©tartrant salle de bain puissant' },
            { name: 'Acide phosphorique', category: 'Acide', icon: 'üß™', description: 'Antirouille, d√©capant m√©taux' },
            { name: 'Naval Jelly', category: 'Acide', icon: 'üß™', description: 'D√©capant antirouille professionnel' },
            { name: 'Iron Out', category: 'Acide', icon: 'üß™', description: 'Enl√®ve-taches de rouille textiles' },
            { name: 'The Works', category: 'Acide', icon: 'üß™', description: 'Nettoyant cuvette acide tr√®s fort' },
            { name: 'Bar Keepers Friend', category: 'Acide', icon: 'üß™', description: 'Nettoyant acide oxalique inox' },
            { name: 'Battery Acid', category: 'Acide', icon: 'üß™', description: 'Acide sulfurique concentr√© auto' },
            { name: 'Cerama Bryte', category: 'Acide', icon: 'üß™', description: 'Nettoyant vitroc√©ramique sp√©cialis√©' },
            { name: 'Acide citrique', category: 'Acide', icon: 'üß™', description: 'D√©tartrant naturel concentr√©' },
            { name: 'Acide oxalique', category: 'Acide', icon: 'üß™', description: 'Blanchisseur bois, enl√®ve-taches' },

            // BASES (60 produits)
            { name: 'Eau de Javel', category: 'Base', icon: 'ü•Ω', description: 'D√©sinfectant chlor√© m√©nager standard' },
            { name: 'Javex', category: 'Base', icon: 'ü•Ω', description: 'Eau de javel commerciale qu√©b√©coise' },
            { name: 'Ammoniaque', category: 'Base', icon: 'ü•Ω', description: 'Nettoyant d√©graissant puissant